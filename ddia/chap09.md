一致性和共識

# 一致性保证

# 线性一致性

提供一种新鲜保证，保证

## 什么使得系统线性一致？

## 线性一致和可序列化

## 依赖线性一致性

### 锁定和领导选举

## 约束和唯一性保证

## 跨信道的时序依赖

# 实现线性一致系统

1. 单主复制（可能线性一致）

因为延时，不能保证副本立即知道主库被写入。

2. 共识算法（线性一致）

3. 多主复制（非线性一致）

由于数据中心之间的网络延迟、网络断开等情况，无法保证一个主库被写时，使另一个主库立即知道。

4. 无主复制（也许不是线性一致）
一个写请求发给多个主库，由于延迟，多个主库被写入的时间差造成了线性不一致。




## 线性一致和法定人数



## 线性一致性的代价


## CAP定理

## 线性一致性和网络延迟

# 顺序保证

## 顺序与因果

## 因果顺序不是全序的

### 线性一致性

### 因果性

## 线性一致性强于因果一致性

### 捕获因果关系

# 序列号顺序

## 非因果序列号生成器

## 兰伯特时间戳

## 光有时间戳排序还不够

# 全序广播

全序广播需要满足两个安全属性：
可靠交付（reliable delivery）
​ 没有消息丢失：如果消息被传递到一个节点，它将被传递到所有节点。
全序交付（totally ordered delivery）*
​ 消息以相同的顺序传递给每个节点。

## 使用全序广播

如果每个消息都代表一次数据库的写入，且每个副本都按相同的顺序处理相同的写入，那么副本间将相互保持一致（除了临时的复制延迟）。这个原理被称为状态机复制（state machine replication）

## 使用全序广播实现线性一致性的存储



## 使用线性一致性的存储实现全序广播

# 分布式事务与共识

非正式地讲，目标只是让几个节点达成一致（get serveral nodes to agree on something）。

节点能达成一致，在很多场景下都非常重要，例如：
1. 领导选举
2. 原子提交：原子事务只有在所有参与者投票提交的情况下才能提交，如果有任何参与者需要中止，则必须中止。 共识则允许就任意一个被参与者提出的候选值达成一致。

> 共识的不可能性

你可能已经听说过作者Fischer，Lynch和Paterson之后的FLP结果【68】，它证明，如果存在节点可能崩溃的风险，则不存在总是能够达成共识的算法。答案是FLP结果在异步系统模型中得到了证明，它假定确定性算法不能使用任何时钟或超时。

## 原子提交与二阶段提交（2PC）

### 从单节点到分布式原子提交
